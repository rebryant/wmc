\documentclass[t,pdf]{beamer}
\mode<presentation>{}


\usecolortheme[RGB={196, 30, 58}]{structure}


\usepackage{color}
\usepackage{animate}
\usepackage{tikz}
\usetikzlibrary{shadings,shadows}
\usetikzlibrary{shapes, arrows}
\usetikzlibrary{decorations.pathreplacing,angles,quotes}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usepackage{pgfplots}
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{scrextend}


\usepackage{hyperref}
%% Colored hyperlink 
\newcommand{\cref}[2]{\href{#1}{\color{blue}#2}}
%% Colored hyperlink showing link in TT font
% \newcommand{\chref}[1]{\href{#1}{\small\tt \color{blue}#1}}
\newcommand{\hcref}[1]{\cref{#1}{\small\tt #1}}

\newcommand{\obar}[1]{\overline{#1}}
\newcommand{\nil}{\bot}
\newcommand{\bitem}{\item[$\bullet$]}
\newcommand{\opos}[1]{#1}
\newcommand{\oneg}[1]{\overline{#1}}
\newcommand{\xnot}{\oneg{x}}
\newcommand{\lit}{\ell}
\newcommand{\approximate}[1]{\hat{#1}}
\newcommand{\approxv}{\approximate{v}}
\newcommand{\approxw}{\approximate{w}}
\newcommand{\assign}{\alpha}
\newcommand{\modelset}{{\cal M}}
\newcommand{\aerror}{\delta}
\newcommand{\digitprecision}{\Delta}


\newcommand{\inputformula}{\phi}
\newcommand{\compiledformula}{\psi}

\usepackage{booktabs,colortbl}

\definecolor{redorange}{rgb}{0.878431, 0.235294, 0.192157}
\definecolor{lightblue}{rgb}{0.552941, 0.72549, 0.792157}
\definecolor{clearyellow}{rgb}{0.964706, 0.745098, 0}
\definecolor{clearorange}{rgb}{0.917647, 0.462745, 0}
\definecolor{mildgray}{rgb}{0.54902, 0.509804, 0.47451}
\definecolor{softblue}{rgb}{0.643137, 0.858824, 0.909804}
\definecolor{bluegray}{rgb}{0.141176, 0.313725, 0.603922}
\definecolor{lightgreen}{rgb}{0.709804, 0.741176, 0}
\definecolor{redpurple}{rgb}{0.835294, 0, 0.196078}
\definecolor{midblue}{rgb}{0, 0.592157, 0.662745}
\definecolor{clearpurple}{rgb}{0.67451, 0.0784314, 0.352941}
\definecolor{browngreen}{rgb}{0.333333, 0.313725, 0.145098}
\definecolor{darkestpurple}{rgb}{0.396078, 0.113725, 0.196078}
\definecolor{greypurple}{rgb}{0.294118, 0.219608, 0.298039}
\definecolor{darktruqoise}{rgb}{0, 0.239216, 0.298039}
\definecolor{darkbrown}{rgb}{0.305882, 0.211765, 0.160784}
\definecolor{midgreen}{rgb}{0.560784, 0.6, 0.243137}
\definecolor{darkred}{rgb}{0.576471, 0.152941, 0.172549}
\definecolor{darkpurple}{rgb}{0.313725, 0.027451, 0.470588}
\definecolor{darkestblue}{rgb}{0, 0.156863, 0.333333}
\definecolor{lightpurple}{rgb}{0.776471, 0.690196, 0.737255}
\definecolor{softgreen}{rgb}{0.733333, 0.772549, 0.572549}
\definecolor{offwhite}{rgb}{0.839216, 0.823529, 0.768627}

\definecolor{mediumgreen}{RGB}{20,140,20}
\definecolor{mediumblue}{RGB}{20,20,140}
\definecolor{medgreen}{rgb}{0.34, 0.65, 0.34}

\newcommand{\red}[1]{\textcolor{red}{#1}}
\definecolor{darkred}{RGB}{180,0,0}
\newcommand{\darkred}[1]{\textcolor{darkred}{#1}}
\definecolor{dominocolor}{RGB}{0,0,128}
\definecolor{darkgreen}{RGB}{0,180,0}
\definecolor{darkgray}{RGB}{128,128,128}
%%\newcommand{\ground}{blue}

%%\newcommand{\ft}[1]{\frametitle{#1}}
%%\newcommand{\ig}[2]{\includegraphics[#1]{#2}}

\definecolor{xred}{rgb}{0.77, 0.12, 0.23}
\definecolor{xgreen}{rgb}{0.3, 0.6, 0}
\definecolor{xblue}{rgb}{0., 0.25, 1}

\newcommand{\btext}[1]{\textcolor{xblue}{#1}}
\newcommand{\rtext}[1]{\textcolor{xred}{#1}}
\newcommand{\gtext}[1]{\textcolor{xgreen}{#1}}
\newcommand{\wtext}[1]{\textcolor{white}{#1}}

\title{\huge Numerical Considerations \\ for Weighted Model Counting}
%\subtitle{}
\author{Randal E. Bryant}
\institute{\includegraphics[height=50pt]{CMU_Logo}}

\date{\textcolor{black}{Workshop on Counting, Sampling, and Synthesis 2025}}


\setbeamertemplate{footline}
{
	\leavevmode%
	\hbox{%
	\begin{beamercolorbox}[wd=0.35\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
%%	\tiny {\url{http://www.cs.cmu.edu/~bryant}}
%%			\vspace{4pt}
	\end{beamercolorbox}%
	\begin{beamercolorbox}[wd=0.45\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
	\end{beamercolorbox}%
	\begin{beamercolorbox}[wd=0.2\paperwidth,ht=2.5ex,dp=1ex,right]{date in head/foot}%
		\structure{\scriptsize \insertframenumber{} / \inserttotalframenumber\hspace*{3ex}}
		\vspace{3pt}
	\end{beamercolorbox}}%
	\vskip0pt%
}

\beamertemplatenavigationsymbolsempty

\begin{document}

\begin{frame}
	\titlepage

\small\url{http://www.cs.cmu.edu/~bryant}
\end{frame}

\begin{frame}

  \frametitle{Weighted Model Counting}

  \begin{center}
\begin{tikzpicture}[scale=0.035]
  \node [left] at (0,25) {$\inputformula$};
  \node [right] at (220,25) {$w(\inputformula)$};
  \node [left] at (0,-20){$w$};

  \draw[fill=structure] (60,0) rectangle (160,50);

%  \draw[line width=2pt] (80,25) [-latex] -- (140,25);
  \draw[line width=2pt] (0,25) [-latex] -- (60,25);
  \draw[line width=2pt] (160,25) [-latex] -- (220,25);
  \draw[line width=2pt] (0,-20) -- (110,-20) [-latex] -- (110,0);

% \node [left] at (10,55) {\begin{tabular}{c} Input\\Formula \end{tabular}};

  \node [left] at (10,52) {Input};
  \node [left] at (10,40) {Formula};

  \node [left] at (10, 7) {Weight};
  \node [left] at (10,-5) {Assignment};

  \node [right] at (210,52) {Weighted};
  \node [right] at (210,40) {Count};


  \node[white] at (110,37) {Weighted};
  \node[white] at (110,25) {Model};
  \node[white] at (110,13) {Counter};
\end{tikzpicture}

\end{center}

\vskip -10pt
  {\bf Given}

  \begin{itemize}
  \item CNF formula $\inputformula$ over variables $X$
  \item Weight assignment $w(x), w(\obar{x}) \in \mathbb{Q}$ for each $x \in X$
  \end{itemize}

  {\bf Compute}
  \begin{displaymath}
  w(\inputformula) \;\; \doteq \;\; \sum_{\assign \in \modelset(\inputformula)} \;\;\prod_{\lit \in \assign} w(\lit) 
  \end{displaymath}

\end{frame}

\begin{frame}
  \frametitle{Numerical Considerations}

\begin{center}
  \Large \emph{What numerical representation should be used?}
\end{center}

\bigskip
\begin{minipage}[t]{0.48\textwidth}
{\bf Rational Arithmetic}
\begin{itemize}
  \bitem Represent $v \in \mathbb{Q}$ as $v = p/q$
  \bitem Represent $p$ and $q$ as multiprecision integers
  \bitem Compute exact result
  \bitem High time and space cost
\end{itemize}
\end{minipage}
\begin{minipage}[t]{0.48\textwidth}
{\bf Floating-Point Arithmetic}
\begin{itemize}
  \bitem Approximate $v \in \mathbb{Q}$ as $\approxv = (-1)^s \times f \times 2^{e}$
  \bitem Represent $f$ and $e$ with fixed number of bits
  \bitem Low time and space cost
\end{itemize}
\end{minipage}

\bigskip
\only<2>{
\textbf{Claim:}

\begin{itemize}
\item  Floating-point preferred
\item But only if can guarantee degree of approximation
\end{itemize}
}

\end{frame}

\begin{frame}

  \frametitle{Weighted Model Counting: Floating-Point Approximation}


\begin{tikzpicture}[scale=0.035]
%  \node [left] at (0,75) {$D$};

  \node [left] at (0,25) {$\inputformula$};
  \node [right] at (220,25) {$\approxw(\inputformula)$};
  \node [left] at (0,-20){$w$};

  \draw[fill=structure] (60,0) rectangle (160,50);

%  \draw[line width=2pt] (80,25) [-latex] -- (140,25);
  \draw[line width=2pt] (0,75) -- (110,75) [-latex] -- (110,50);

  \draw[line width=2pt] (0,25) [-latex] -- (60,25);
  \draw[line width=2pt] (160,25) [-latex] -- (220,25);
  \draw[line width=2pt] (0,-20) -- (110,-20) [-latex] -- (110,0);

% \node [left] at (10,55) {\begin{tabular}{c} Input\\Formula \end{tabular}};

  \node [left] at (10,102) {Target};
  \node [left] at (10,90) {Precision};


  \node [left] at (10,52) {Input};
  \node [left] at (10,40) {Formula};

  \node [left] at (10, 7) {Weight};
  \node [left] at (10,-5) {Assignment};

  \node [right] at (210,64) {Approximate};
  \node [right] at (210,52) {Weighted};
  \node [right] at (210,40) {Count};


  \node[white] at (110,37) {Weighted};
  \node[white] at (110,25) {Model};
  \node[white] at (110,13) {Counter};
\end{tikzpicture}

\bigskip

  {\bf Approximation}

  \begin{itemize}
  \item Set target precision $D$
  \item Compute approximation $\approxw(\inputformula)$
  \item Within specified precision
  \end{itemize}

\end{frame}

\begin{frame}
  \frametitle{Approximation Metrics}

For value $v$ and its approximation $\approxv$:

  \begin{displaymath}
\aerror[\approxv, v] \;\; \doteq \;\; \left\{ \begin{array}{lll}
  \frac{|\approxv - v|}{|v|}  & v \not = 0 & \textsf{Relative \; error}\\[0.5em]
  0 & v  = \approxv = 0 & 0 \approx 0\\[0.5em]
  1 & v = 0 \; \textrm{and} \; \approxv \not = 0 & 0 \not \approx \epsilon,\;\epsilon \not = 0
  \end{array} \right.
\end{displaymath}

\bigskip

\textbf{Digit Precision}

\begin{displaymath}
  \digitprecision(\approxv, v) \;\; \doteq \;\; \max(0, -\log_{10} \aerror[\approxv, v])
\end{displaymath}

\begin{itemize}
 \item Number of trustworthy digits in decimal representation
\item  $= \infty$ when $v = \approxv$
\item $= 0$ when $v \not = 0$ and $\approxv = 0$
\end{itemize}

\end{frame}

\begin{frame}

  \frametitle{Weighted Model Counting: Floating-Point Approximation}


\begin{tikzpicture}[scale=0.035]
  \node [left] at (0,75) {$D$};

  \node [left] at (0,25) {$\inputformula$};
  \node [right] at (220,25) {$\approxw(\inputformula)$};
  \node [left] at (0,-20){$w$};

  \draw[fill=structure] (60,0) rectangle (160,50);

%  \draw[line width=2pt] (80,25) [-latex] -- (140,25);
  \draw[line width=2pt] (0,75) -- (110,75) [-latex] -- (110,50);

  \draw[line width=2pt] (0,25) [-latex] -- (60,25);
  \draw[line width=2pt] (160,25) [-latex] -- (220,25);
  \draw[line width=2pt] (0,-20) -- (110,-20) [-latex] -- (110,0);

% \node [left] at (10,55) {\begin{tabular}{c} Input\\Formula \end{tabular}};

  \node [left] at (10,102) {Target};
  \node [left] at (10,90) {Precision};


  \node [left] at (10,52) {Input};
  \node [left] at (10,40) {Formula};

  \node [left] at (10, 7) {Weight};
  \node [left] at (10,-5) {Assignment};

  \node [right] at (210,64) {Approximate};
  \node [right] at (210,52) {Weighted};
  \node [right] at (210,40) {Count};


  \node[white] at (110,37) {Weighted};
  \node[white] at (110,25) {Model};
  \node[white] at (110,13) {Counter};
\end{tikzpicture}

\bigskip

  {\bf Approximation}

  \begin{itemize}
  \item Set target precision $D$
  \item Compute approximation $\approxw(\inputformula)$
  \item Require $\digitprecision(\approxw, w) \geq D$
  \end{itemize}

\end{frame}

\begin{frame}
  \frametitle{Choosing Target Precision}

\bigskip
  $D = 1$
  \begin{itemize}
    \item $10\%$ accuracy
    \item Good enough for 2020 Weighted Model Competition

  \end{itemize}

\bigskip
  $D = 3$
  \begin{itemize}
    \item $0.1\%$ accuracy
    \item Good enough for 2024 Weighted Model Competition
  \end{itemize}

\bigskip
\only<2>{
  $D = 30$
  \begin{itemize}
  \item Distance from Earth to Alpha Centauri $\approx 4.37$ light years.
  \item Hydrogen atom diameter $\approx 100$ picometers.
  \item $D=30$ can represent distance from Earth to Alpha Centauri to nearest picometer
  \end{itemize}
}

\end{frame}

\begin{frame}

  \frametitle{Via Knowledge Compilation}

  \begin{center}
\begin{tikzpicture}[scale=0.035]
  \node [left] at (0,75) {$D$};
  \node [left] at (0,25) {$\inputformula$};
  \node [right] at (220,25) {$\approxw(\inputformula)$};
  \node [left] at (0,-20){$w$};

  \node at (110,25) {$\psi$};

  \draw[fill=structure] (20,0) rectangle (80,50);
  \draw[fill=structure] (140,0) rectangle (200,50);

  \draw[line width=2pt] (0,25) [-latex] -- (20,25);
%  \draw[line width=2pt] (80,25) [-latex] -- (140,25);

  \draw[line width=2pt] (80,25) [-latex] -- (100,25);  
  \draw[line width=2pt] (120,25) [-latex] -- (140,25);

  \draw[line width=2pt] (200,25) [-latex] -- (220,25);

  \draw[line width=2pt] (0,75) -- (170,75) [-latex] -- (170,50);
  \draw[line width=2pt] (0,-20) -- (170,-20) [-latex] -- (170,0);

% \node [left] at (10,55) {\begin{tabular}{c} Input\\Formula \end{tabular}};
  \node [left] at (10,102) {Target};
  \node [left] at (10,90) {Precision};


  \node [left] at (10,52) {Input};
  \node [left] at (10,40) {Formula};

  \node [left] at (10, 7) {Weight};
  \node [left] at (10,-5) {Assignment};

  
  \node at (110,60) {decision-DNNF};
  \node at (110,48) {Formula};

  \node [right] at (210,64) {Approximate};
  \node [right] at (210,52) {Weighted};
  \node [right] at (210,40) {Count};


  \node[white] at (50,31) {Knowledge};
  \node[white] at (50,19) {Compiler};

  \node[white] at (170,37) {Weighted};
  \node[white] at (170,25) {Model};
  \node[white] at (170,13) {Counter};
\end{tikzpicture}
\end{center}

  \begin{itemize}
  \item Convert input formula $\inputformula$ into logically equivalent formula $\psi$
  \item $\psi$ has form that makes weighted counting tractable
  \end{itemize}

\end{frame}

\begin{frame}

  \frametitle{Weighted Model Counting}

  \begin{center}
\begin{tikzpicture}[scale=0.035]
  \node [left] at (0,75) {$D$};
  \node [left] at (0,25) {$\inputformula$};
  \node [right] at (220,25) {$\approxw(\inputformula)$};
  \node [left] at (0,-20){$w$};

  \node at (110,25) {$\psi$};

  \draw[fill=structure] (20,0) rectangle (80,50);
  \draw[fill=structure] (140,0) rectangle (200,50);

  \draw[line width=2pt] (0,25) [-latex] -- (20,25);
%  \draw[line width=2pt] (80,25) [-latex] -- (140,25);

  \draw[line width=2pt] (80,25) [-latex] -- (100,25);  
  \draw[line width=2pt] (120,25) [-latex] -- (140,25);

  \draw[line width=2pt] (200,25) [-latex] -- (220,25);

  \draw[line width=2pt] (0,75) -- (170,75) [-latex] -- (170,50);
  \draw[line width=2pt] (0,-20) -- (170,-20) [-latex] -- (170,0);

% \node [left] at (10,55) {\begin{tabular}{c} Input\\Formula \end{tabular}};
  \node [left] at (10,102) {Target};
  \node [left] at (10,90) {Precision};


  \node [left] at (10,52) {Input};
  \node [left] at (10,40) {Formula};

  \node [left] at (10, 7) {Weight};
  \node [left] at (10,-5) {Assignment};

  
  \node at (110,60) {decision-DNNF};
  \node at (110,48) {Formula};

  \node [right] at (210,64) {Approximate};
  \node [right] at (210,52) {Weighted};
  \node [right] at (210,40) {Count};


  \node[white] at (50,31) {Knowledge};
  \node[white] at (50,19) {Compiler};

  \node[white] at (170,31) {Weighted};
  \node[white] at (170,19) {Counter};
\end{tikzpicture}

\end{center}
\end{frame}


\end{document}

  \draw[fill=structure] (8,10) rectangle (20,18);
  \node at (14,19.5) {(Hard)};

  \draw[fill=structure] (38,10) rectangle (50,18);
  \node[white] at (44,15.3) {Model};
  \node[white] at (44,12.7) {Counter};
  \node at (44,19.5) {(Easy)};

  \node at (29,16.6) {Compiled};
  \node at (29,14.0) {Form};
  \node at (29,11.4) {$\psi$};

  \draw[line width=2pt] (4,14)  [-latex] -- (8,14);
  \draw[line width=2pt] (20,14) [-latex] -- (24,14);
  \draw[line width=2pt] (34,14) [-latex] -- (38,14);
  \draw[line width=2pt] (50,14) [-latex] -- (54,14);




\begin{frame}
  \frametitle{Beyond SAT: Model Counting}

\medskip
\begin{minipage}{0.49\textwidth}
\begin{center}
  {\bf Formula $\inputformula$}\\[0.25em]
  \begin{tabular}{lc}
    $[\oneg{x}_1 \lor \opos{x}_3 \lor \oneg{x}_4]$ & $\land$ \\
    $[\oneg{x}_1 \lor \oneg{x}_3 \lor \opos{x}_4]$ & $\land$ \\
    $[\opos{x}_1 \lor \opos{x}_3 \lor \oneg{x}_4]$ & $\land$ \\
    $[\opos{x}_1 \lor \oneg{x}_3 \lor \opos{x}_4]$ & $\land$ \\
    $[\oneg{x}_1 \lor \oneg{x}_2]$ &  \\
  \end{tabular}
%%  \begin{tabular}{ccccc}
%%    $\oneg{x}_1$ & $\lor$ &  $\opos{x}_3$ & $\lor$ &  $\oneg{x}_4$ \\
%%    $\oneg{x}_1$ & $\lor$ &  $\oneg{x}_3$ & $\lor$ &  $\opos{x}_4$ \\
%%    $\opos{x}_1$ & $\lor$ &  $\opos{x}_3$ & $\lor$ &  $\oneg{x}_4$ \\
%%    $\opos{x}_1$ & $\lor$ &  $\oneg{x}_3$ & $\lor$ &  $\opos{x}_4$ \\
%%    $\oneg{x}_1$ & $\lor$ & $\oneg{x}_2$ \\
%%  \end{tabular}
\end{center}
\end{minipage}
\begin{minipage}{0.49\textwidth}
\begin{center}
  {\bf Models ${\cal M}(\inputformula)$}\\[0.25em]
  \begin{tabular}{cc}
    $\;$\\
    $\{ \oneg{x}_1, \oneg{x}_2, \oneg{x}_3, \oneg{x}_4 \}$ &
    $\{ \oneg{x}_1, \oneg{x}_2, \opos{x}_3, \opos{x}_4 \}$ \\
    $\{ \oneg{x}_1, \opos{x}_2, \opos{x}_3, \opos{x}_4 \}$ &
    $\{ \opos{x}_1, \oneg{x}_2, \opos{x}_3, \opos{x}_4 \}$ \\
    $\{ \oneg{x}_1, \opos{x}_2, \oneg{x}_3, \oneg{x}_4 \}$ &
    $\{ \opos{x}_1, \oneg{x}_2, \oneg{x}_3, \oneg{x}_4 \}$ \\
    $\;$\\
  \end{tabular}
\end{center}
\end{minipage}

\medskip

{\bf Definitions:}
\smallskip
\begin{itemize}
\item ${\cal M}(\phi)$: Set of satisfying assignments for formula $\phi$
\item ${\cal V}(\phi)$: Set of variables occuring in $\phi$
\end{itemize}

\medskip

{\bf Model Counting Problem}
\begin{itemize}
\item Given formula $\inputformula$, compute $|{\cal M}(\inputformula)|$
\item Challenging: \#SAT more difficult than SAT
\item Further challenge: Guarantee correctness of result
\end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Knowledge Compilation}
\medskip
  \begin{itemize}
  \item Darwiche and Marquis~\reference{DM}{2002}
  \end{itemize}

\medskip

\begin{minipage}{\textwidth}
\centering{
\begin{tikzpicture}[scale=0.16]
  \node [left] at (3,14) {$\inputformula$};
  \node [right] at (55,14) {$|{\cal M}(\inputformula)|$};


  \draw[fill=structure] (8,10) rectangle (20,18);
  \node[white] at (14,15.3) {Knowledge};
  \node[white] at (14,12.7) {Compiler};
  \node at (14,19.5) {(Hard)};

  \draw[fill=structure] (38,10) rectangle (50,18);
  \node[white] at (44,15.3) {Model};
  \node[white] at (44,12.7) {Counter};
  \node at (44,19.5) {(Easy)};

  \node at (29,16.6) {Compiled};
  \node at (29,14.0) {Form};
  \node at (29,11.4) {$\psi$};

  \draw[line width=2pt] (4,14)  [-latex] -- (8,14);
  \draw[line width=2pt] (20,14) [-latex] -- (24,14);
  \draw[line width=2pt] (34,14) [-latex] -- (38,14);
  \draw[line width=2pt] (50,14) [-latex] -- (54,14);
\end{tikzpicture}
}
\end{minipage}

\medskip
  {\bf Convert CNF formula into more tractable representation}
  \begin{itemize}
  \item Potentially exponential size
  \item Model counting polynomial in size of representation
  \end{itemize}

  \smallskip

\only<2->{
  {\bf Concerns:}
  \begin{itemize}
  \item Must prove compiled formula $\psi$ logically equivalent to input formula $\phi_I$
    \begin{itemize}
      \bitem Two-sided problem
      \bitem Requires proof of form $\phi_I \; \Leftrightarrow \; \psi$
    \end{itemize}
  \item Is the counting of $\psi$ computed correctly?
  \end{itemize}
}

\end{frame}

\begin{frame}

   \frametitle{(Weighted) Model Counting}

\medskip

\begin{itemize}
     \item Assign weight $w(x_i)$ to each input variable $x_i$
       \begin{itemize}
         \bitem $0.0 \leq w(x_i) \leq  1.0$
       \end{itemize}
     \item Define $w(\xnot_i) = 1-w(x_i)$
       \begin{itemize}
         \bitem Write as $\pneg w(x_i)$
       \end{itemize}
     \item Weighted count $W(\phi)$ of formula $\phi$:
   \end{itemize}
   \begin{eqnarray*}
     W(\phi) & = & \sum_{\alpha \in {\cal M}(\phi)} \; \prod_{\ell_i \in \alpha} w(\ell_i)
   \end{eqnarray*}

\only<2>{
{\bf Standard Model Counting}

\smallskip

\begin{itemize}
\item $w(x_i) = w(\oneg{x}_i) = 1/2$ for all $i$
\item $W(\phi)$ gives \structure{density} of function
  \begin{itemize}
    \bitem Fraction of assignments that satisfy $\phi$
  \end{itemize}
\item Scale by $2^n$ to get model count
\end{itemize}
}
\end{frame}


\begin{frame}
  \frametitle{d-DNNF Formulas}
  \begin{itemize}
\item
    Deterministic, Decomposable, Negation-Normal Form~\reference{DM}{2002}
  \end{itemize}

\medskip

\begin{center}
  \begin{tabular}{lcc}
    \multicolumn{1}{c}{\textbf{Operation}} & \makebox[5em][l]{\textbf{Formula}} & \textbf{Requirement} \\
   \midrule
   Decomposable Product & $\phi_1 \pand \phi_2$ & ${\cal V}(\phi_1) \;\cap\; {\cal V}(\phi_2) = \emptyset$ \\
   Deterministic Sum  & $\phi_1 \por \phi_2$ & ${\cal M}(\phi_1) \;\cap\; {\cal M}(\phi_2) = \emptyset$ \\
   Negated Variable & $\neg x$ \\
  \end{tabular}
\end{center}

  \medskip
      {\bf Weighted Count of d-DNNF Formula}
      \begin{eqnarray*}
        W(\phi_1 \pand \phi_2) & = & W(\phi_1) \,\times W(\phi_2)\\[1.5ex]
        W(\phi_1 \por \phi_2) & = & W(\phi_1) \,+ W(\phi_2)\\[1.5ex]
        W(\neg x) & = & \pneg W(x) \;\; \doteq \;\; 1-W(x)
      \end{eqnarray*}

\end{frame}

\begin{frame}
  \frametitle{Partitioned-Operation Graph (POG)}

\medskip
\begin{minipage}{0.49\textwidth}
\begin{center}
  {\bf Formula $\inputformula$}\\[0.25em]
  \begin{tabular}{lc}
    $[\oneg{x}_1 \lor \opos{x}_3 \lor \oneg{x}_4]$ & $\land$ \\
    $[\oneg{x}_1 \lor \oneg{x}_3 \lor \opos{x}_4]$ & $\land$ \\
    $[\opos{x}_1 \lor \opos{x}_3 \lor \oneg{x}_4]$ & $\land$ \\
    $[\opos{x}_1 \lor \oneg{x}_3 \lor \opos{x}_4]$ & $\land$ \\
    $[\oneg{x}_1 \lor \oneg{x}_2]$ &  \\
  \end{tabular}
%%  \begin{tabular}{ccccc}
%%    $\oneg{x}_1$ & $\lor$ &  $\opos{x}_3$ & $\lor$ &  $\oneg{x}_4$ \\
%%    $\oneg{x}_1$ & $\lor$ &  $\oneg{x}_3$ & $\lor$ &  $\opos{x}_4$ \\
%%    $\opos{x}_1$ & $\lor$ &  $\opos{x}_3$ & $\lor$ &  $\oneg{x}_4$ \\
%%    $\opos{x}_1$ & $\lor$ &  $\oneg{x}_3$ & $\lor$ &  $\opos{x}_4$ \\
%%    $\oneg{x}_1$ & $\lor$ & $\oneg{x}_2$ \\
%%  \end{tabular}
\end{center}
\end{minipage}
\begin{minipage}{0.49\textwidth}
  \centering{
%%  {\bf POG} \\[0.3em]
  \input{dd/eg4-slides-alt}
  } % Centering
\end{minipage}

\medskip

\begin{itemize}
\item Directed graph representation of d-DNNF formula
\item Input edge can be negative or positive
\item Root represented by extension variable $r$
\end{itemize}

\end{frame}


\begin{frame}
  \frametitle{Weighted Count of POG}

\medskip
\begin{minipage}{0.49\textwidth}
  \centering{
%%  {\bf POG} \\[0.3em]
  \input{dd/eg4-slides-alt}
  } % Centering
\end{minipage}
\begin{minipage}{0.49\textwidth}
  \centering{
%%  {\bf Ring Evaluation} \\[0.3em]
  \input{dd/eg4-wmc}
  } % Centering
\end{minipage}

\medskip

\begin{itemize}
\item Evaluation: Number of operations linear in graph size
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Certifying Toolchain}


\medskip
\centering{
\begin{tikzpicture}[scale=0.13]
  \draw[fill=blue!10!white] (48,-2) rectangle (65,22);

  \draw[fill=structure] (8,10) rectangle (20,18);
  \node[white] at (14,15.2) {\footnotesize Knowledge};
  \node[white] at (14,12.8) {\footnotesize Compiler};

  \draw[fill=structure] (28,10) rectangle (40,18);
  \node[white] at (34,15.2) {\footnotesize Proof};
  \node[white] at (34,12.8) {\footnotesize Generator};


  \draw[fill=structure] (51,10) rectangle (63,18);
  \node[white] at (57,15.2) {\footnotesize Proof};
  \node[white] at (57,12.8) {\footnotesize Checker};

  \draw[fill=structure] (51,0) rectangle (63,8);
  \node[white] at (57,5.2) {\footnotesize Weighted};
  \node[white] at (57,2.8) {\footnotesize Counter};


  \node at (57,20) {\footnotesize Trusted Code};

  %% CNF
  \draw[line width=2pt] (0,20) -- (44,20) -- (44,16) [-latex] -- (51,16);
  \draw[line width=2pt] (4,20) -- (4,16) [-latex] -- (8,16);
  \draw[line width=2pt] (24,20) -- (24,16) [-latex] -- (28,16);
  \node [left] at (-1,20) {$\inputformula$};
  \node [above] at (2,20) {\footnotesize \texttt{.cnf}};

  %% NNF
  \draw[line width=2pt] (20,12) [-latex] -- (28,12);
  \node [above] at (24,12) {\footnotesize \texttt{.ddnnf}};

  %% CPOG
  \draw[line width=2pt] (40,12) [-latex] -- (51,12);
  \draw[line width=2pt] (44,12) -- (44,4) [-latex] -- (51,4);
  \node [above] at (44,12) {\footnotesize \texttt{.cpog}};

  %% OK/Not
  \draw[line width=2pt] (63,14) [-latex] -- (68,14) ;
  \node [right] at (68,15.2) {\footnotesize  OK /} ;
  \node [right] at (68,12.8) {\footnotesize  Not OK} ;
  \draw[line width=2pt] (63,4) [-latex] -- (68,4) ;
  \node [right] at (68,4) {$W (\inputformula)$};
\end{tikzpicture}
} %% Centering
\vskip -1em

\begin{itemize}
\item \structure{Knowledge Compiler} (D4 \reference{LM}{2017}): Convert CNF into d-DNNF.  Unmodified.
\item \structure{Proof Generator}: Generate file combining POG definition + equivalence proof
\item \structure{Proof Checker}: Validate proof file 
\item \structure{Weighted Counter}: Compute standard or weighted model count
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Verifying the Trusted Code}

\begin{center}
\begin{tikzpicture}[scale=0.13]
  \draw[fill=blue!10!white] (48,-2) rectangle (65,22);

  \draw[fill=structure] (8,10) rectangle (20,18);
  \node[white] at (14,15.2) {\footnotesize Knowledge};
  \node[white] at (14,12.8) {\footnotesize Compiler};

  \draw[fill=structure] (28,10) rectangle (40,18);
  \node[white] at (34,15.2) {\footnotesize Proof};
  \node[white] at (34,12.8) {\footnotesize Generator};


  \draw[fill=structure] (51,10) rectangle (63,18);
  \node[white] at (57,15.2) {\footnotesize Proof};
  \node[white] at (57,12.8) {\footnotesize Checker};

  \draw[fill=structure] (51,0) rectangle (63,8);
  \node[white] at (57,5.2) {\footnotesize Weighted};
  \node[white] at (57,2.8) {\footnotesize Counter};


  \node at (57,20) {\footnotesize \textbf{Verified} Code};

  %% CNF
  \draw[line width=2pt] (0,20) -- (44,20) -- (44,16) [-latex] -- (51,16);
  \draw[line width=2pt] (4,20) -- (4,16) [-latex] -- (8,16);
  \draw[line width=2pt] (24,20) -- (24,16) [-latex] -- (28,16);
  \node [left] at (-1,20) {$\inputformula$};
  \node [above] at (2,20) {\footnotesize \texttt{.cnf}};

  %% NNF
  \draw[line width=2pt] (20,12) [-latex] -- (28,12);
  \node [above] at (24,12) {\footnotesize \texttt{.ddnnf}};

  %% CPOG
  \draw[line width=2pt] (40,12) [-latex] -- (51,12);
  \draw[line width=2pt] (44,12) -- (44,4) [-latex] -- (51,4);
  \node [above] at (44,12) {\footnotesize \texttt{.cpog}};

  %% OK/Not
  \draw[line width=2pt] (63,14) [-latex] -- (68,14) ;
  \node [right] at (68,15.2) {\footnotesize  OK /} ;
  \node [right] at (68,12.8) {\footnotesize  Not OK} ;
  \draw[line width=2pt] (63,4) [-latex] -- (68,4) ;
  \node [right] at (68,4) {$W (\inputformula)$};
\end{tikzpicture}
\end{center}


\textbf{Verified Checkers}

\begin{itemize}
\item Verify soundness of proof framework + correctness of checker
\item Lean4: 2023 \reference{BNAH}{2025}.  %%Included verified counter
\item CakeML/HOL: 2025 \reference{BTH}{2025}.  Support projection
\end{itemize}
\end{frame}

\begin{frame}
  \frametitle{CPOG Example: Formula}
\bigskip
\begin{minipage}[t]{0.58\textwidth}
{\bf Input Formula $\inputformula$}
\medskip
  \begin{itemize}
  \item Encode $x_1 \leftrightarrow x_2$.
  \item CNF representation:\\[.3em]
    \begin{itemize}
      \item[] $[\opos{x}_1 \lor \oneg{x}_2] \land [\oneg{x}_1 \lor \opos{x}_2]$
    \end{itemize}
  \end{itemize}
\bigskip

{\bf Clause Database}\\[0.5em]
\begin{tabular}{rlll}
\toprule
  ID & Literals & Explanation\\
\midrule
  \rtext{1} & \gtext{\texttt{1 -2}} & Input  \\
  \rtext{2} & \gtext{\texttt{-1 2}} & Input  \\
\bottomrule
\end{tabular}

\end{minipage}
\begin{minipage}[t]{0.4\textwidth}
{\bf Generated POG}
\begin{center}
  \input{dd/eg2a-tree}
\end{center}
\end{minipage}
\end{frame}

\begin{frame}
  \frametitle{CPOG Proof Requirements}
  \medskip
  \textbf{Structural Properties}
  \begin{itemize}
  \item Every product is decomposable: ${\cal V}(\phi_1) \;\cap\; {\cal V}(\phi_2) = \emptyset$
\medskip
  \item Every sum is deterministic: ${\cal M}(\phi_1) \;\cap\; {\cal M}(\phi_2) = \emptyset$
\medskip
  \end{itemize}
  
  \medskip
  \textbf{Forward Implication}
  \begin{itemize}
  \item \emph{Don't undercount}
  \item Every assignment satisfying $\inputformula$ causes POG to evaluate to 1.
  \end{itemize}
  \medskip
  \textbf{Reverse Implication}
  \begin{itemize}
  \item \emph{Don't overcount}
  \item Every assignment falsifying $\inputformula$ causes POG to evaluate to 0.
\only<2>{
\item Recast as:
  \begin{itemize}
    \bitem For each input clause $C$: Any assignment falsifying  $C$ causes POG to evaluate to 0.
  \end{itemize}
}
  \end{itemize}

\end{frame}

\begin{frame}
  \frametitle{CPOG Proof Methodology}
  \medskip
  \textbf{Structural Properties}
  \begin{itemize}
  \item Every product is decomposable:  ${\cal V}(\phi_1) \;\cap\; {\cal V}(\phi_2) = \emptyset$
    \begin{itemize}
     \bitem Check dependency sets for all product arguments
    \end{itemize}
  \item Every sum is deterministic:  ${\cal M}(\phi_1) \;\cap\; {\cal M}(\phi_2) = \emptyset$
    \begin{itemize}
      \bitem Justify mutually-exclusive arguments for each sum operation
    \end{itemize}
  \end{itemize}
  
  \medskip
  \textbf{Forward Implication}
  \begin{itemize}
  \item Every assignment satisfying $\inputformula$ causes POG to evaluate to 1.
  \item Justify unit clause $[r]$ by RUP additions to clausal representation
  \end{itemize}
  \medskip
  \textbf{Reverse Implication}
  \begin{itemize}
  \item For each input clause $C$: Any assignment falsifying $C$ causes POG to evaluate to 0.
  \item Justify by unit propagation on POG
  \end{itemize}
\end{frame}


\begin{frame}
\frametitle{CPOG Example: POG Declaration}

\begin{minipage}{0.58\textwidth}
  \input{dd/eg2a-tree}

  {\bf CPOG Declarations}\\[0.5em]
\begin{tabular}{rll}
  \midrule
\only<1-2>{
  \makebox[3mm][r]{\rtext{\texttt{3}}} & \texttt{p \btext{3} \gtext{-1 -2}} & \texttt{0} \\
  \rtext{\texttt{6}} & \texttt{p \btext{4} \gtext{1 2}} & \texttt{0} \\
}
\only<2-3>{
  \makebox[3mm][r]{\rtext{\texttt{9}}} & \texttt{s \btext{5} \gtext{3 4} \rtext{4 7}} & \texttt{0} \\
  \bottomrule
}
  \end{tabular}
\only<3>{
\medskip
\begin{itemize}
\item Sum declaration must justify mutual exclusion
\item Resolving clauses 4 and 7 gives $\oneg{p}_3 \lor \oneg{p}_4$.
\end{itemize}
} %% only

\end{minipage}
\begin{minipage}{0.4\textwidth}
{\bf Clause Database}\\[0.5em]
\begin{tabular}{rll}
\toprule
  ID & Literals &  Explanation\\
\midrule
  \rtext{1} & \gtext{\texttt{1 -2}} &  Input \\
  \rtext{2} & \gtext{\texttt{-1 2}} &  Input \\
\midrule
  \rtext{3} & \gtext{\texttt{3 1 2}} &  $\nodep_3$ \\
  \only<1-2>{\rtext{4}}\only<3>{\rtext{*4}} & \gtext{\texttt{-3 -1}} &   \\
  \rtext{5} & \gtext{\texttt{-3 -2}} &   \\
\midrule
  \rtext{6} & \gtext{\texttt{4 -1 -2}} & $\nodep_4$ \\
  \only<1-2>{\rtext{7}}\only<3>{\rtext{*7}} & \gtext{\texttt{-4 1}} & \\
  \rtext{8} & \gtext{\texttt{-4 2}} &   \\
\midrule
\only<2->{
  \rtext{9} & \gtext{\texttt{-5 3 4}} &  $\nodes_5$ \\
  \rtext{10} & \gtext{\texttt{5 -3}} &   \\
  \rtext{11} & \gtext{\texttt{5 -4}} &   \\
\bottomrule
}
\end{tabular}
\end{minipage}
\end{frame}

\begin{frame}
  \frametitle{CPOG Example: Forward Implication}

\medskip

\begin{minipage}{0.58\textwidth}
  \begin{center}
    \input{dd/eg2a-tree}
  \end{center}

  {\bf CPOG Assertions}\\[0.5em]
  \begin{tabular}{rllll}
%%  \toprule
%%  \multicolumn{5}{c}{CPOG line}  \\
  \midrule
  \makebox[3mm][r]{\rtext{\texttt{12}}} & \texttt{a \gtext{-2 5}} & \texttt{0} & \texttt{\rtext{11 1 6}} & \texttt{0} \\
  \rtext{\texttt{13}} & \texttt{a \gtext{5}} & \texttt{0} & \texttt{\rtext{10 12 2 3}} & \texttt{0} \\
  \bottomrule
  \end{tabular}

  \medskip

  \begin{itemize}
    \item Give justifying RUP sequences
    \item Finish with unit clause
  \end{itemize}
  

\end{minipage}
\begin{minipage}{0.4\textwidth}
%%{\bf Defined Clauses}\\[0.5em]
\begin{tabular}{rll}
%%\toprule
%%  ID & Literals & Explanation\\
\midrule
  \rtext{1} & \gtext{\texttt{1 -2}} &  Input \\
  \rtext{2} & \gtext{\texttt{-1 2}} &  Input \\
\midrule
  \rtext{3} & \gtext{\texttt{3 1 2}} &  $\nodep_3$ \\
  \rtext{4} & \gtext{\texttt{-3 -1}} &   \\
  \rtext{5} & \gtext{\texttt{-3 -2}} &   \\
  \midrule
  \rtext{6} & \gtext{\texttt{4 -1 -2}} &  $\nodep_4$ \\
  \rtext{7} & \gtext{\texttt{-4 1}} &   \\
  \rtext{8} & \gtext{\texttt{-4 2}} &   \\
  \midrule
  \rtext{9} & \gtext{\texttt{-5 3 4}} &  $\nodes_5$ \\
  \rtext{10} & \gtext{\texttt{5 -3}} &   \\
  \rtext{11} & \gtext{\texttt{5 -4}} &   \\
\midrule
  \rtext{12} & \gtext{\texttt{-2 5}} &    \\
  \rtext{13} & \gtext{\texttt{5}} &   Root literal $r$ \\
\bottomrule
\end{tabular}
\end{minipage}
\end{frame}


\begin{frame}
  \frametitle{Proof Generation: Monolithic Method}

\medskip

\begin{minipage}[t]{0.48\textwidth}
{\bf Input + Negated POG} \\[0.5em]
%%{\bf Defined Clauses}\\[0.5em]
\begin{tabular}{rll}
%%\toprule
%%  ID & Literals & Explanation\\
\midrule
  \rtext{1} & \gtext{\texttt{1 -2}} &  Input \\
  \rtext{2} & \gtext{\texttt{-1 2}} &  Input \\
\midrule
  \rtext{3} & \gtext{\texttt{3 1 2}} &  $\nodep_3$ \\
  \rtext{4} & \gtext{\texttt{-3 -1}} &   \\
  \rtext{5} & \gtext{\texttt{-3 -2}} &   \\
  \rtext{6} & \gtext{\texttt{4 -1 -2}} &  $\nodep_4$ \\
  \rtext{7} & \gtext{\texttt{-4 1}} &   \\
  \rtext{8} & \gtext{\texttt{-4 2}} &   \\
  \rtext{9} & \gtext{\texttt{-5 3 4}} &  $\nodes_5$ \\
  \rtext{10} & \gtext{\texttt{5 -3}} &   \\
  \rtext{11} & \gtext{\texttt{5 -4}} &   \\
\midrule
  \rtext{12} & \emph{\gtext{\texttt{-5}}} &   \emph{Negated root} $\obar{r}$ \\
\bottomrule
\end{tabular}
\end{minipage}
\begin{minipage}[t]{0.48\textwidth}
\only<2->{
{\bf UNSAT Proof}\\[0.5em]
  \begin{tabular}{rllll}
%%  \toprule
%%  \multicolumn{5}{c}{CPOG line}  \\
%  \midrule
  \makebox[3mm][r]{\rtext{\texttt{13}}} & \texttt{\gtext{-2}} & \texttt{0} & \texttt{\rtext{12 11 1 6}} & \texttt{0} \\
  \rtext{\texttt{14}} & \texttt{} & \texttt{0} & \texttt{\rtext{12 10 13 2 3}} & \texttt{0} \\
%  \bottomrule
  \end{tabular}
}
\bigskip


\only<3>{
  {\bf CPOG Assertions}
  \medskip
  \begin{itemize}
    \item Add root literal to each clause
    \item Renumber hints
  \end{itemize}
\medskip
  \begin{tabular}{rllll}
%%  \toprule
%%  \multicolumn{5}{c}{CPOG line}  \\
%  \midrule
  \makebox[3mm][r]{\rtext{\texttt{12}}} & \texttt{a \gtext{-2 5}} & \texttt{0} & \texttt{\rtext{11 1 6}} & \texttt{0} \\
  \rtext{\texttt{13}} & \texttt{a \gtext{5}} & \texttt{0} & \texttt{\rtext{10 12 2 3}} & \texttt{0} \\
%  \bottomrule
  \end{tabular}
}
\end{minipage}
\end{frame}

\begin{frame}
  \frametitle{Forward Implication Proof Generation}

  \bigskip

  \textbf{Monolithic}

  \begin{itemize}
  \item Use UNSAT proof of input formula + negated POG
  \item Works even if input formula transformed by preprocessing
  \end{itemize}
  \medskip

  \textbf{Structural}
  \begin{itemize}
  \item Based on branching structure of POG
  \item Requires direct compilation of formula
  \end{itemize}
  \medskip
    
  \textbf{Hybrid}
  \begin{itemize}
  \item Start at root with structural approach and recursively descend
  \item Switch to monolithic when POG gets small enough
  \end{itemize}

\end{frame}

\begin{frame}
\frametitle{CPOG Example: Reverse Implication}
\medskip
\begin{itemize}
\item Efficient clausal entailment test for DNNF formulas \reference{DM}{2002}
\end{itemize}
\medskip
\begin{minipage}{0.48\textwidth}
  \textbf{Clause \#1}:
  \vskip -10pt
  \begin{displaymath}
  [\opos{x}_1 \lor \oneg{x}_2]
  \end{displaymath}
  \textbf{Negation}:
  \vskip -10pt
  \begin{displaymath}
  \oneg{x}_1 \; \land \; \opos{x}_2
  \end{displaymath}
\textbf{Unit Propagation}
  \vskip -10pt
\begin{center}
  \input{dd/eg2a-tree-c1}
\end{center}
\end{minipage}
\begin{minipage}{0.48\textwidth}
  \textbf{Clause \#2}:
  \vskip -10pt
  \begin{displaymath}
  [\oneg{x}_1 \lor \opos{x}_2]
  \end{displaymath}
  \textbf{Negation}:
  \vskip -10pt
  \begin{displaymath}
  \opos{x}_1 \; \land \; \oneg{x}_2
  \end{displaymath}
\textbf{Unit Propagation}
  \vskip -10pt
\begin{center}
  \input{dd/eg2a-tree-c2}
\end{center}
\end{minipage}

\end{frame}

\begin{frame}
\frametitle{Experimental Results: Verified Knowledge Compilation}

\bigskip

\begin{minipage}{0.65\textwidth}
\begin{tikzpicture}[scale = 0.50]
  \begin{axis}[mark options={scale=0.55},height=14cm,width=12cm,grid=both, grid style={black!10}, ymode=log,
      legend style={at={(0.99,0.30)}},
      legend cell align={left},
                              %x post scale=1.8, y post scale=2.5,
                              xmode=log,
                              xmin=0.008,xmax=4000,
                              xtick={0.01, 0.1,1.0,10,100,1000,10000}, xticklabels={0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
                              ymin=0.008, ymax=29000,
                              ytick={0.01, 0.1,1.0,10,100,1000,10000,100000}, yticklabels={0.01, 0.1, 1.0, 10, 100, {1,000},{10,000},{100,000}},
                              xlabel={D4 runtime (seconds)}, ylabel={Verification time (seconds)},
%                              title={D4 Defining Clause Generation}
            ]
    \input{data-formatted/seconds-summary}
    \input{data-formatted/seconds-summary-onesided}
    \input{data-formatted/seconds-summary-failures}
    \legend{
      \scriptsize \textsf{Full validation},
      \scriptsize \textsf{Reverse only},
      \scriptsize \textsf{No validation},
    }
    \input{data-formatted/seconds-summary-structured-only}
    \addplot[mark=none, dashed] coordinates{(0.001,25000) (4000, 25000)};) 
    \addplot[mark=none, color=lightblue] coordinates{(0.001,20000) (4000,20000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.01,0.001) (10000.0,1000.0)};
    \addplot[mark=none, color=lightblue] coordinates{(0.001,0.001) (10000.0,10000.0)};
    \addplot[mark=none, color=lightblue] coordinates{(0.001,0.01) (2000,20000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.001,0.10) (200, 20000)};
%%    \addplot[mark=none, color=lightblue] coordinates{(0.001,1.0) (20, 20000)};
    \node[left] at (axis cs: 0.9,0.12) {$0{.}1\times$};
    \node[left] at (axis cs: 0.09,0.12) {$1\times$};
    \node[left] at (axis cs: 0.09,1.2) {$10\times$};
    \node[left] at (axis cs: 0.09,12.0) {$100\times$};
%%    \node[left] at (axis cs: 0.09,120.0) {$1000\times$};
       \end{axis}
\end{tikzpicture}
\end{minipage}
\begin{minipage}{0.32\textwidth}

  {\bf Benchmarks}

  \begin{itemize}
    \bitem 2022 MC Competition
    \bitem $\leq$ 4000s
    \bitem 180 formulas
    \bitem 123 compiled 
  \end{itemize}

  \smallskip

   {\bf Outcomes}

\smallskip
   \begin{tabular}{lr}
     Fully verified & 111 \\
     Reverse only & 7 \\
     No validation & 5
   \end{tabular}

 \medskip

   {\bf Check:Compile}

\smallskip
   \begin{tabular}{lr}
     Minimum & $0.9\times$ \\
     Median & $12.5\times$ \\
     Maximum &  $117.0\times$ \\
   \end{tabular}
\end{minipage}
\end{frame}


\begin{frame}
  \frametitle{Projected Knowledge Compilation}


  \begin{itemize}
  \item Data variables $D = \{x_1, x_2\}$
  \item Quantified variables $\rtext{Y} = \{\rtext{x_3}, \rtext{x_4}\}$
  \item Generate representation of $\exists \rtext{Y} \, \inputformula(D, \rtext{Y})$
  \end{itemize}

  \bigskip

  \begin{minipage}{0.35\textwidth}
    \begin{center}
      {\bf Formula} \\
      $\inputformula$ \\[0.5em]
  \begin{tabular}{lc}
    $[\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}]$ & $\land$ \\
    $[\opos{x}_2 \lor \rtext{\oneg{x}_3}]$ & $\land$ \\
    $[\opos{x}_2 \lor \rtext{\oneg{x}_4}]$ &  \\
    $\;$ \\
    $\;$ \\
    $\;$ \\
    $\;$ \\
    $\;$ \\
    $\;$ \\
  \end{tabular}
    \end{center}
  \end{minipage}
  \begin{minipage}{0.30\textwidth}
    \begin{center}
      {\bf Models} \\
      ${\cal M}(\inputformula)$ \\[0.5em]
  \begin{tabular}{c}
    $\{ \opos{x}_1, \oneg{x}_2, \rtext{\oneg{x}_3},  \rtext{\oneg{x}_4} \}$ \\
    \midrule
    $\{ \opos{x}_1, \opos{x}_2, \rtext{\oneg{x}_3},  \rtext{\oneg{x}_4} \}$ \\
    $\{ \opos{x}_1, \opos{x}_2, \rtext{\oneg{x}_3},  \rtext{\opos{x}_4} \}$ \\
    $\{ \opos{x}_1, \opos{x}_2, \rtext{\opos{x}_3},  \rtext{\oneg{x}_4} \}$ \\
    $\{ \opos{x}_1, \opos{x}_2, \rtext{\opos{x}_3},  \rtext{\opos{x}_4} \}$ \\
    \midrule
    $\{ \oneg{x}_1, \opos{x}_2, \rtext{\oneg{x}_3},  \rtext{\opos{x}_4} \}$ \\
    $\{ \oneg{x}_1, \opos{x}_2, \rtext{\opos{x}_3},  \rtext{\oneg{x}_4} \}$ \\
    $\{ \oneg{x}_1, \opos{x}_2, \rtext{\opos{x}_3},  \rtext{\opos{x}_4} \}$ \\
  \end{tabular}
    \end{center}
  \end{minipage}
  \begin{minipage}{0.30\textwidth}
 \begin{center}
   {\bf Data Models} \\
   ${\cal M}_D(\inputformula)$\\[0.5em]
  \begin{tabular}{c}
    $\{ \opos{x}_1, \oneg{x}_2 \}$ \\
    \midrule
    $\{ \opos{x}_1, \opos{x}_2 \}$ \\
    $\;$ \\
    $\;$ \\
    $\;$ \\
    \midrule
    $\{ \oneg{x}_1, \opos{x}_2 \}$ \\
    $\;$ \\
    $\;$ \\
  \end{tabular}
 \end{center}
  \end{minipage}
\end{frame}


\begin{frame}

  \frametitle{Projected Knowledge Compilation}

\vskip -15pt
  \begin{displaymath}
    \inputformula \;\; = \;\; 
    [\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_3}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_4}]
  \end{displaymath}
\vskip 5pt

  \begin{minipage}[t]{0.49\textwidth}
    \textbf{Without Projection}
\vskip -10pt
    \begin{center}
    \input{dd/simple-noproj}
    \end{center}
  \end{minipage}
  \begin{minipage}[t]{0.49\textwidth}
    \textbf{After Projection}
\vskip -10pt
    \begin{center}
    \input{dd/simple-proj}
    \end{center}
    \textbf{Certification}
    \begin{itemize}
    \item Forward implication holds
    \item Reverse implication does not
    \end{itemize}
  \end{minipage}
  
\end{frame}

\begin{frame}

\frametitle{PKC: Skolem POG}

\begin{itemize}
\item Bryant, Tan, Heule~\reference{BTH}{2025}
\end{itemize}
%\vskip -10pt
  \begin{displaymath}
    \inputformula \;\; = \;\; 
    [\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_3}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_4}]
  \end{displaymath}

\medskip

  \begin{minipage}{0.39\textwidth}
    \begin{center}
    \input{dd/simple-skolem}
    \end{center}
  \end{minipage}
  \begin{minipage}{0.59\textwidth}
    \begin{displaymath}
      \exists \rtext{x_3}, \rtext{x_4} \, \inputformula(x_1, x_2, \rtext{x_3}, \rtext{x_4})
    \end{displaymath}
    \textbf{Normal Mode}
    \begin{itemize}
    \item Skolem nodes are tautologies
    \item Represents compiler output
    \end{itemize}
    \medskip
    \textbf{Skolem Mode}
    \begin{itemize}
    \item Skolem nodes enable reverse implication
    \item Define Skolem assignment to quantified variables
    \end{itemize}
  \end{minipage}


\end{frame}

\begin{frame}
\frametitle{Skolem POG: Reverse Implication}
\begin{minipage}[t]{0.32\textwidth}
\vskip -20pt
  \begin{displaymath}
  [\opos{x}_1 \lor \rtext{x_3} \lor \rtext{x_4}]
  \end{displaymath}
  \vskip -10pt
  \textbf{Negation}:
  \vskip -25pt
  \begin{displaymath}
  \oneg{x}_1 \; \land \; \rtext{\oneg{x}_3} \; \land \rtext{\oneg{x}_4}
  \end{displaymath}
  \vskip -10pt
\textbf{Unit Propagation}
  \vskip -10pt
\begin{center}
  \input{dd/simple-skolem-c1}
\end{center}
\end{minipage}
%%%%%
\begin{minipage}[t]{0.32\textwidth}
\vskip -10pt
  \begin{displaymath}
  [\opos{x}_2 \lor \rtext{\oneg{x}_3}]
  \end{displaymath}
  \vskip -5pt
  \textbf{Negation}:
  \vskip -15pt
  \begin{displaymath}
  \oneg{x}_2 \; \land \; \rtext{\opos{x}_3}
  \end{displaymath}
  \vskip -5pt
\textbf{Unit Propagation}
  \vskip -5pt
\begin{center}
  \input{dd/simple-skolem-c2}
\end{center}
\end{minipage}
%%%%%
\begin{minipage}[t]{0.32\textwidth}
\vskip -10pt
  \begin{displaymath}
  [\opos{x}_2 \lor \rtext{\oneg{x}_4}]
  \end{displaymath}
  \vskip -5pt
  \textbf{Negation}:
  \vskip -15pt
  \begin{displaymath}
  \oneg{x}_2 \; \land \; \rtext{\opos{x}_4}
  \end{displaymath}
  \vskip -5pt
\textbf{Unit Propagation}
  \vskip -5pt
\begin{center}
  \input{dd/simple-skolem-c3}
\end{center}
\end{minipage}

\end{frame}

\begin{frame}
\frametitle{Certifying Toolchain}


\medskip
\centering{
\begin{tikzpicture}[scale=0.13]
  \draw[fill=blue!10!white] (48,-2) rectangle (65,22);

  \draw[fill=structure] (8,10) rectangle (20,18);
  \node[white] at (14,15.2) {\footnotesize Knowledge};
  \node[white] at (14,12.8) {\footnotesize Compiler+};

  \draw[fill=structure] (28,10) rectangle (40,18);
  \node[white] at (34,15.2) {\footnotesize Proof};
  \node[white] at (34,12.8) {\footnotesize Generator};


  \draw[fill=structure] (51,10) rectangle (63,18);
  \node[white] at (57,15.2) {\footnotesize Proof};
  \node[white] at (57,12.8) {\footnotesize Checker};

  \draw[fill=structure] (51,0) rectangle (63,8);
  \node[white] at (57,5.2) {\footnotesize Weighted};
  \node[white] at (57,2.8) {\footnotesize Counter};


  \node at (57,20) {\footnotesize Trusted Code};

  %% CNF
  \draw[line width=2pt] (0,20) -- (44,20) -- (44,16) [-latex] -- (51,16);
  \draw[line width=2pt] (4,20) -- (4,16) [-latex] -- (8,16);
  \draw[line width=2pt] (24,20) -- (24,16) [-latex] -- (28,16);
  \node [left] at (0,20) {$\begin{array}{c} \inputformula \\[0.5em] D \end{array}$};
  \node [above] at (2,20) {\footnotesize \texttt{.cnf}};

  %% NNF
  \draw[line width=2pt] (20,12) [-latex] -- (28,12);
  \node [below] at (24,10) {\footnotesize \texttt{.ddnnf+}};

  %% CPOG
  \draw[line width=2pt] (40,12) [-latex] -- (51,12);
  \draw[line width=2pt] (44,12) -- (44,4) [-latex] -- (51,4);
  \node [above] at (44,12) {\footnotesize \texttt{.scpog}};

  %% OK/Not
  \draw[line width=2pt] (63,14) [-latex] -- (68,14) ;
  \node [right] at (68,15.2) {\footnotesize  OK /} ;
  \node [right] at (68,12.8) {\footnotesize  Not OK} ;
  \draw[line width=2pt] (63,4) [-latex] -- (68,4) ;
  \node [right] at (68,4) {$W (\exists Y\,\inputformula)$};
\end{tikzpicture}
} %% Centering
\vskip -1em

\begin{itemize}
\item \structure{Knowledge Compiler} (D4 \reference{LM}{2017}): Convert CNF into d-DNNF with projection.  Slightly modified.
\item \structure{Proof Generator}: Generate file combining Skolem POG definition + equivalence proof
\item \structure{Proof Checker}: Validate proof file 
\item \structure{Weighted Counter}: Compute standard or weighted model count
\end{itemize}

\end{frame}


\begin{frame}

\frametitle{Projected Knowledge Compilation: Normal Operation}

\vskip -15pt
  \begin{displaymath}
    \inputformula \;\; = \;\; 
    [\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_3}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_4}]
  \end{displaymath}
\vskip 5pt

\begin{minipage}[t]{0.48\textwidth}
  \textbf{Branch and Propagate}
  
\begin{center}
  \input{dd/simple-pkc}
\end{center}

\begin{itemize}
\item Split only on data variables
\item Unit propagate both data and quantified variables
\only<3->{\item Stop when only have quantified variables}
\end{itemize}
\end{minipage}  
\only<4->{\begin{minipage}[t]{0.48\textwidth}
  \textbf{Compiled Output}
  
\begin{center}
  \input{dd/simple-proj}
\end{center}
\vskip -10pt
\begin{itemize}
\item Omit quantified variables
\item Call SAT solver on terminal formulas
\end{itemize}
  \end{minipage}
  } %% Only

\end{frame}  

\begin{frame}

\frametitle{PKC: Skolem POG Generation}

\vskip -15pt
  \begin{displaymath}
    \inputformula \;\; = \;\; 
    [\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_3}] \; \land \;
    [\opos{x}_2 \lor \rtext{\oneg{x}_4}]
  \end{displaymath}
\vskip 5pt

\begin{minipage}[t]{0.48\textwidth}
  \textbf{Branch and Propagate}
  
\begin{center}
  \input{dd/simple-pkc-done}
\end{center}
\vskip -10pt
\begin{itemize}
\item Retain quantified variables
\item Get solution for terminal formulas
\item Small changes to D4
\end{itemize}
\end{minipage}  
\begin{minipage}[t]{0.48\textwidth}
  \textbf{Compiled Output}
  
\begin{center}
  \input{dd/simple-skolem}
\end{center}
\end{minipage}


\end{frame}  


\begin{frame}

  \frametitle{Soundness (1)}


\begin{minipage}[t]{0.25\textwidth}
\begin{center}
  \textbf{Skolem POG}\\[0.2em]
  $\hat{\psi}(D, Y)$
\end{center}
\end{minipage}
\begin{minipage}[t]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[t]{0.35\textwidth}
\begin{center}
  \textbf{Input Formula}\\[0.2em]
  $\inputformula(D, Y)$
\end{center}
\end{minipage}
\begin{minipage}[t]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[t]{0.25\textwidth}
\begin{center}
  \textbf{Projected POG}\\[0.2em]
  $\psi(D)$
\end{center}
\end{minipage}

\medskip

\begin{minipage}[c]{0.25\textwidth}
\begin{center}
\includegraphics[scale=0.5]{dd/simple-skolem-doc}
\end{center}
\end{minipage}
\begin{minipage}[c]{0.05\textwidth}
$\overset{\textrm{REV}}{\Longrightarrow}$
\end{minipage}
\begin{minipage}[c]{0.35\textwidth}
\begin{displaymath}
\begin{array}{cc}
[\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] & \land \\[1em]
[\opos{x}_2 \lor \rtext{\oneg{x}_3}] & \land \\[1em]
[\opos{x}_2 \lor \rtext{\oneg{x}_4}] & 
\end{array}
\end{displaymath}
\end{minipage}
\begin{minipage}[c]{0.05\textwidth}
$\overset{\textrm{FWD}}{\Longrightarrow}$
\end{minipage}
\begin{minipage}[c]{0.25\textwidth}
\begin{center}
    \includegraphics[scale=0.5]{dd/simple-proj-doc}
\end{center}
\end{minipage}

\only<2>{
\begin{center}
\vskip -10pt
\begin{displaymath}
  \begin{array}{ccccc}
    {\cal M}(\hat{\psi}) & \subseteq & {\cal M}(\inputformula) & \subseteq & {\cal M}(\psi) \\[1em]
    {\cal M}_{D}(\hat{\psi}) & \subseteq & {\cal M}_{D}(\inputformula) & \subseteq & {\cal M}_{D}(\psi) \\[1em]
  \end{array}
\end{displaymath}
\end{center}
} % \only
\end{frame}  

\begin{frame}

  \frametitle{Soundness (2)}


\begin{minipage}[t]{0.45\textwidth}
\begin{center}
  \textbf{Skolem POG}\\[0.2em]
  $\hat{\psi}(D, Y)$
\end{center}
\end{minipage}
\begin{minipage}[t]{0.45\textwidth}
\begin{center}
  \textbf{Projected POG}\\[0.2em]
  $\psi(D)$
\end{center}
\end{minipage}

\medskip

\begin{minipage}[c]{0.45\textwidth}
\begin{center}
\includegraphics[scale=0.5]{dd/simple-skolem-doc}
\end{center}
\end{minipage}
\begin{minipage}[c]{0.45\textwidth}
\begin{center}
    \includegraphics[scale=0.5]{dd/simple-proj-doc}
\end{center}
\end{minipage}


\begin{center}
\vskip -10pt
\begin{displaymath}
  \begin{array}{ccc}
    {\cal M}_{D}(\hat{\psi}) & = & {\cal M}_{D}(\psi)
  \end{array}
\end{displaymath}
\end{center}

\vskip -5pt

\begin{itemize}
\item Requires decomposable products
\end{itemize}
\end{frame}  

\begin{frame}

  \frametitle{Soundness (3)}


\begin{minipage}[t]{0.25\textwidth}
\begin{center}
  \textbf{Skolem POG}\\[0.2em]
  $\hat{\psi}(D, Y)$
\end{center}
\end{minipage}
\begin{minipage}[t]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[t]{0.35\textwidth}
\begin{center}
  \textbf{Input Formula}\\[0.2em]
  $\inputformula(D, Y)$
\end{center}
\end{minipage}
\begin{minipage}[t]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[t]{0.25\textwidth}
\begin{center}
  \textbf{Projected POG}\\[0.2em]
  $\psi(D)$
\end{center}
\end{minipage}

\medskip

\begin{minipage}[c]{0.25\textwidth}
\begin{center}
\includegraphics[scale=0.5]{dd/simple-skolem-doc}
\end{center}
\end{minipage}
\begin{minipage}[c]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[c]{0.35\textwidth}
\begin{displaymath}
\begin{array}{cc}
[\opos{x}_1 \lor \rtext{\opos{x}_3} \lor \rtext{\opos{x}_4}] & \land \\[0.5em]
[\opos{x}_2 \lor \rtext{\oneg{x}_3}] & \land \\[0.5em]
[\opos{x}_2 \lor \rtext{\oneg{x}_4}] & 
\end{array}
\end{displaymath}
\end{minipage}
\begin{minipage}[c]{0.05\textwidth}
$\;$
\end{minipage}
\begin{minipage}[c]{0.25\textwidth}
\begin{center}
    \includegraphics[scale=0.5]{dd/simple-proj-doc}
\end{center}
\end{minipage}

\begin{center}
\vskip -10pt
\begin{displaymath}
  \begin{array}{ccccc}
    {\cal M}_{D}(\hat{\psi}) & \subseteq & {\cal M}_{D}(\inputformula) & \subseteq & {\cal M}_{D}(\psi) \\[0.5em]
    {\cal M}_{D}(\hat{\psi}) &  & = & & {\cal M}_{D}(\psi) \\[0.5em]
\only<2>{{\cal M}_{D}(\hat{\psi}) & = & \rtext{{\cal M}_{D}(\inputformula)} & \rtext{=} & \rtext{{\cal M}_{D}(\psi)}} \\[0.5em]
  \end{array}
\end{displaymath}
\end{center}

\end{frame}  


\begin{frame}
\frametitle{Experimental Results: Skolem vs.~Regular Projected POG}
\bigskip
\begin{minipage}{0.67\textwidth}
\begin{tikzpicture}[scale = 0.70]
  \begin{axis}[mark options={scale=0.55},height=10cm,width=10cm,grid=both, grid style={black!10},
                              %x post scale=1.85, y post scale=2.2,
                              xmode=log, xmin=1, xmax=1e10,
                              % xtick={0.001, 0.01, 0.1,1.0,10,100,1000,10000,100000}, xticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}, {100,000}},
                              ymode=log, ymin=1, ymax=1e10,
%                              ytick={0.001, 0.01, 0.1,1.0,10,100,1000,10000}, yticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
                              xlabel={Regular POG (clauses)}, ylabel={Skolem POG (clauses)},
            ]
    \input{data-formatted/d4-compare-all-clauses}
    \addplot[mark=none, color=lightblue] coordinates{(1,1) (1e10,1e10)};
    \addplot[mark=none, color=lightblue] coordinates{(1,10) (1e9,1e10)};
    \addplot[mark=none, color=lightblue] coordinates{(1,100) (1e8,1e10)};
    \addplot[mark=none, color=lightblue] coordinates{(1,1e3) (1e7,1e10)};
    \addplot[mark=none, color=lightblue] coordinates{(1,1e4) (1e6,1e10)};
    \node[left] at (axis cs: 10,10) {\tiny$1\times$};
    \node[left] at (axis cs: 10,100) {\tiny$10\times$};
    \node[left] at (axis cs: 20,2e3) {\tiny$100\times$};
    \node[left] at (axis cs: 20,2e4) {\tiny$1000\times$};
    \node[left] at (axis cs: 20,2e5) {\tiny$10{,}000\times$};
          \end{axis}
\end{tikzpicture}
\end{minipage}
\begin{minipage}{0.31\textwidth}
\begin{itemize}
\bitem Overhead for storing Skolem information    
\end{itemize}

\medskip
  {\bf Benchmarks}

  \begin{itemize}
    \bitem 2024 PMC Competition
    \bitem $\leq$ 1000s
    \bitem 389 formulas
    \bitem 175 compiled 
  \end{itemize}

{\bf Ratios}\\[0.5em]
   \begin{tabular}{lr}
     Minimum & $1\times$ \\
     Median & $34\times$ \\
     Maximum &  $4857\times$ \\
   \end{tabular}
\end{minipage}
\end{frame}

\begin{frame}
\frametitle{Experimental Results: Data Variable Fraction}
\begin{center}
\begin{tikzpicture}[scale = 0.70]
  \begin{axis}[mark options={scale=0.55},height=8cm,width=11cm,grid=both, grid style={black!10},
                              %x post scale=1.85, y post scale=2.2,
                              xmode=log, xmin=1, xmax=1e6,
                              % xtick={0.001, 0.01, 0.1,1.0,10,100,1000,10000,100000}, xticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}, {100,000}},
                              ymode=log, ymin=1, ymax=1e4,
%                              ytick={0.001, 0.01, 0.1,1.0,10,100,1000,10000}, yticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
                              xlabel={Total Variables}, ylabel={Data Variables},
            ]
    \input{data-formatted/compiled-cnf-data}
    \addplot[mark=none, color=lightblue] coordinates{(1,1) (1e10,1e10)};
    \addplot[mark=none, color=lightblue] coordinates{(10,1) (1e10,1e9)};
    \addplot[mark=none, color=lightblue] coordinates{(100,1) (1e10,1e8)};
    \addplot[mark=none, color=lightblue] coordinates{(1e3,1) (1e10,1e7)};
    \addplot[mark=none, color=lightblue] coordinates{(1e4,1) (1e10,1e6)};
    \node[right] at (axis cs: 1.5,1.5) {\small$1.0\times$};
    \node[right] at (axis cs: 15,1.5) {\small$0.1\times$};
    \node[right] at (axis cs: 150,1.5) {\small$0.01\times$};
    \node[right] at (axis cs: 1500,1.5) {\small$0.001\times$};
    \node[right] at (axis cs: 15000,1.5) {\small$0.0001\times$};
          \end{axis}
\end{tikzpicture}
\end{center}

\begin{minipage}[t]{0.48\textwidth}
  {\bf Observation}
  
\begin{itemize}
\bitem Many variables eliminated by projection
\end{itemize}
\end{minipage}
\begin{minipage}[t]{0.1\textwidth}
$\;$
\end{minipage}
\begin{minipage}[t]{0.38\textwidth}
{\bf Ratios}\\[0.5em]
   \begin{tabular}{lr}
     Minimum & $0.01\%$ \\
     Median & $2.02\%$ \\
     Maximum &  $69.23\%$ \\
   \end{tabular}
\end{minipage}
\end{frame}


\begin{frame}
  \frametitle{Experimental Results: PKC Sequential Check}
  
\begin{minipage}{0.65\textwidth}
\begin{tikzpicture}[scale = 0.50]
  \begin{axis}[mark options={scale=0.55},height=12cm,width=12cm,grid=both, grid style={black!10},
      legend style={at={(0.99,0.30)}},
      legend cell align={left},
      x post scale=1.1, y post scale=1.5,
      xmode=log,xmin=0.01,xmax=4000,
      xtick={0.01, 0.1,1.0,10,100,1000,10000}, xticklabels={0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
      ymode=log,ymin=0.01, ymax=2e5,
      ytick={0.01, 0.1,1.0,10,100,1000,10000,1e5}, yticklabels={0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}, {100,000}},
      xlabel={D4 runtime (seconds)},
      ylabel={Verification time (seconds)},
    ]
    \input{data-formatted/run-compare-verified-seconds}
    \input{data-formatted/run-compare-unverified-seconds}
    \legend{
      \textsf{Verified},
%      \textsf{Forward verification},
      \textsf{Not verified}
    }
    \addplot[mark=none, color=lightblue] coordinates{(0.1,0.01) (10000.0,1000.0)};
    \addplot[mark=none, color=lightblue, thick] coordinates{(0.01,0.01) (10000.0,10000.0)};
    \addplot[mark=none, color=lightblue] coordinates{(0.01,0.1) (10000,100000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.01,1.0) (10000,1000000)};
    \addplot[mark=none, color=lightblue, thick] coordinates{(0.01,1e5) (1e4,1e5)};
    \addplot[mark=none, color=black, dashed] coordinates{(0.01,1.5e5) (10000,1.5e5)};
    \input{data-formatted/run-compare-unverified-seconds}
    \node[left] at (axis cs: 0.8,0.08) {$0{.}1\times$};
    \node[left] at (axis cs: 0.8,0.8) {$1\times$};
    \node[left] at (axis cs: 0.8,8.0) {$10\times$};
    \node[left] at (axis cs: 0.8,80.0) {$100\times$};
  \end{axis}
\end{tikzpicture}
\end{minipage}
\begin{minipage}{0.33\textwidth}

  {\bf Benchmarks}

  \begin{itemize}
    \bitem 389 formulas
%    \bitem 4000s compilation limit
    \bitem 175 compiled 
  \end{itemize}

  \medskip

   {\bf Outcomes}\\[0.0em]

   \begin{tabular}{lr}
     Fully verified & 172 \\
     No validation & 3
   \end{tabular}

 \medskip

   {\bf Check:Compile}\\[-0.2em]

   \begin{tabular}{lr}
     Minimum & $0.0001\times$ \\
     Median & $3.3\times$ \\
     Average & $6.1\times$ \\
     Maximum &  $193.8\times$ \\
   \end{tabular}
\end{minipage}

\end{frame}


\begin{frame}
  \frametitle{Experimental Results: PKC Multithreaded Check}
  
\begin{minipage}{0.65\textwidth}
\begin{tikzpicture}[scale = 0.50]
  \begin{axis}[mark options={scale=0.55},height=12cm,width=12cm,grid=both, grid style={black!10},
      legend style={at={(0.99,0.30)}},
      legend cell align={left},
      x post scale=1.1, y post scale=1.5,
      xmode=log,xmin=0.01,xmax=4000,
      xtick={0.01, 0.1,1.0,10,100,1000,10000}, xticklabels={0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
      ymode=log,ymin=0.01, ymax=2e5,
      ytick={0.01, 0.1,1.0,10,100,1000,10000,1e5}, yticklabels={0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}, {100,000}},
      xlabel={D4 runtime (seconds)},
      ylabel={Verification time (seconds)},
    ]
    \input{data-formatted/run-compare-parallel-verified-seconds}
    \input{data-formatted/run-compare-unverified-seconds}
    \legend{
      \textsf{Verified},
%      \textsf{Forward verification},
      \textsf{Not verified}
    }
    \addplot[mark=none, color=lightblue] coordinates{(0.1,0.01) (10000.0,1000.0)};
    \addplot[mark=none, color=lightblue, thick] coordinates{(0.01,0.01) (10000.0,10000.0)};
    \addplot[mark=none, color=lightblue] coordinates{(0.01,0.1) (10000,100000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.01,1.0) (10000,1000000)};
    \addplot[mark=none, color=lightblue, thick] coordinates{(0.01,1e5) (1e4,1e5)};
    \addplot[mark=none, color=black, dashed] coordinates{(0.01,1.5e5) (10000,1.5e5)};
    \input{data-formatted/run-compare-unverified-seconds}
    \node[left] at (axis cs: 0.8,0.08) {$0{.}1\times$};
    \node[left] at (axis cs: 0.8,0.8) {$1\times$};
    \node[left] at (axis cs: 0.8,8.0) {$10\times$};
    \node[left] at (axis cs: 0.8,80.0) {$100\times$};
  \end{axis}
\end{tikzpicture}
\end{minipage}
\begin{minipage}{0.33\textwidth}


  {\bf Reverse Implication}
  \medskip

  \begin{itemize}
    \bitem Each clause checked independently
    \bitem 7-way multithreading
    \bitem $3\times$ speedup
  \end{itemize}


 \medskip

   {\bf Check:Compile}\\[-0.2em]

   \begin{tabular}{lr}
     Minimum & $0.0001\times$ \\
     Median & $3.0\times$ \\
     Average & $5.1\times$ \\
     Maximum &  $191.7\times$ \\
   \end{tabular}
\end{minipage}

\end{frame}


\begin{frame}
\frametitle{PKC: Verified vs.~Unverified (Sequential) Checker}
\begin{center}
\begin{tikzpicture}[scale = 0.70]
  \begin{axis}[mark options={scale=0.55},height=10cm,width=12cm,grid=both, grid style={black!10},
      legend style={at={(0.99,0.30)}},
      legend cell align={left},
                              %x post scale=1.85, y post scale=2.2,
                              xmode=log, xmin=0.0008, xmax=100000,
                              xtick={0.001, 0.01, 0.1,1.0,10,100,1000,10000,100000}, xticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}, {100,000}},
                              ymode=log, ymin=0.0008, ymax=2000,
                              ytick={0.001, 0.01, 0.1,1.0,10,100,1000,10000}, yticklabels={0.001, 0.01, 0.1, 1.0, 10, 100, {1,000}, {10,000}},
                              xlabel={Unverified checker (seconds)}, ylabel={Verified checker (seconds)},
            ]
    \input{data-formatted/cakeml-compare-verified-seconds}
    \input{data-formatted/cakeml-compare-failed-seconds}
    \legend{
      \textsf{Formally verified},
      \textsf{Memory limit exceeded}
    }
    \addplot[mark=none, color=lightblue] coordinates{(0.001,0.001) (1000,1000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.001,0.01) (100,1000)};
    \addplot[mark=none, color=lightblue] coordinates{(0.001,1000) (100000,1000)};
    \addplot[mark=none, color=black, dashed] coordinates{(0.001,1500) (100000,1500)};
    \node[right] at (axis cs: 0.010,0.007) {$1\times$};
    \node[left] at (axis cs: 0.009,0.12) {$10\times$};
          \end{axis}
\end{tikzpicture}
\end{center}
\end{frame}

\begin{frame}

  \frametitle{To Do: Blocked Clause Elimination}

  \medskip

  {\bf Blocked Clause} $\lit \land C$
  \begin{itemize}
  \item For every clause $\obar{\lit} \land D$:
  \item[$\quad\quad$] There is  literal $m$ with $m \in C$ and $\obar{m} \in D$
  \end{itemize}

  \medskip

  {\bf Blocked Clause Elimination} \reference{LMB}{2024}
  \begin{itemize}
  \item Can eliminate blocked clause if $\textrm{var}(\lit) \in Y$
  \item Implemented as inprocessing rule.  Applied contextually
  \end{itemize}

  \medskip

  {\bf Verification Challenge}
  \begin{itemize}
  \item Skolem POG may indicate assignment that violates $\lit \land C$
  \item Cannot complete reverse-implication proof
  \end{itemize}

  \medskip
      {\bf Possible Fix?}
      \begin{itemize}
      \item Modify D4 to indicate context in which BCE occurs
      \item Apply solution reconstruction to Skolem POG to add and modify Skolem nodes
      \end{itemize}

\end{frame}

\begin{frame}
  \frametitle{Final Observations}

  \bigskip

  \textbf{Lessons Learned}
  \smallskip
  \begin{itemize}
  \item Formal verification of proof framework important
    \begin{itemize}
      \bitem Verified framework + checker
      \bitem Many subtle details in devising proof framework
      \bitem Allows more explorations and optimizations
    \end{itemize}
  \end{itemize}

  \bigskip

  \textbf{Ongoing Challenges}
  \smallskip
  \begin{itemize}
  \item Enabling formal verification by nonexperts
  \item Scaling proof generation and checking
  \item Supporting new solver optimizations
  \end{itemize}

\end{frame}


\input{bryant-dagstuhl-2025-refs}

\end{document}
